# Instructions pour GitHub Copilot - PelletsFun

## Contexte du projet
Ce projet est une application de gestion de donn√©es de chaudi√®re √† pellets avec :
- Backend Node.js/Express avec MongoDB
- Frontend React
- Int√©gration Gmail API pour import automatique
- D√©ploiement sur serveur Proxmox

## Instructions de d√©veloppement

### Architecture
- Respecter la structure 3-sections pliables dans l'interface (Configuration, Import & Traitement, Analyse & Historique)
- Maintenir la persistance des configurations en base de donn√©es
- Suivre les patterns √©tablis pour les mod√®les MongoDB (BoilerConfig, GmailConfig, etc.)

### Bonnes pratiques
- Toujours valider les entr√©es utilisateur c√¥t√© backend
- Utiliser les styles CSS existants dans BoilerManagerRestructured.css
- Maintenir la coh√©rence des messages d'erreur et de succ√®s
- Logger les op√©rations importantes avec des emojis pour faciliter le debugging

### Gestion des donn√©es
- √âviter la duplication de donn√©es en MongoDB (optimisation quota)
- Impl√©menter la suppression en cascade pour maintenir l'int√©grit√©
- Utiliser les agr√©gations MongoDB pour les statistiques
- Maintenir l'historique des imports avec cat√©gorisation temporelle

### Interface utilisateur
- Utiliser les composants pliables existants
- Maintenir l'accessibilit√© (focus states, ARIA labels)
- Responsive design obligatoire
- Confirmations utilisateur pour les actions destructives

### Configuration Gmail
- Centraliser toute la configuration Gmail dans GmailConfig
- Supporter les multi-exp√©diteurs via le tableau senders
- G√©rer la migration automatique des anciennes configurations
- Maintenir la compatibilit√© OAuth2 avec refresh tokens

## Processus de version et d√©ploiement

### √Ä la fin de chaque d√©veloppement d'√©volution
**INTERDIT** : Ne jamais proposer de d√©ploiement local ou de production apr√®s une √©volution.
**INTERDIT** : Ne jamais proposer de build apr√®s une √©volution (ex.: `npm run build`).
**INTERDIT** : Ne jamais cr√©er de documentation sans demande explicite.

### Commande de d√©ploiement production
**‚ö†Ô∏è ATTENTION - SYNTAXE OBLIGATOIRE :**
**Lorsque je demande de commiter et d√©ployer en production**, utiliser **EXCLUSIVEMENT** cette syntaxe :
```bash
./deploy-production.sh "Message de commit d√©taill√©"
```

**‚ùå NE JAMAIS :**
- Ex√©cuter `./deploy-production.sh` sans message
- Proposer `git add` ou `git commit` s√©par√©ment
- Lancer le serveur de d√©veloppement (`./start-dev.sh`)

**‚úÖ CORRECT :**
```bash
./deploy-production.sh "feat: Ajout suppression imports avec validation"
```

**‚úÖ AVEC MESSAGE D√âTAILL√â :**
```bash
./deploy-production.sh "‚ú® Interface r√©volutionn√©e: s√©lection multi-mois cross-ann√©e + design moderne

üé® Am√©liorations majeures:
- S√©lection multiple ind√©pendante des ann√©es  
- Auto-s√©lection des 3 derniers mois
- Interface compacte avec boutons toggle
- Design √©l√©gant avec gradients

üîß Corrections techniques:
- Format selectedMonths cross-ann√©e
- Logique de s√©lection persistante
- UX am√©lior√©e avec √©tats visuels

üöÄ R√©sultat: Interface moderne et fonctionnelle"
```

Format des commandes recommand√© :
```bash
git add .
git commit -m "feat: Description concise de l'√©volution

- Point cl√© 1 en fran√ßais
- Point cl√© 2 en fran√ßais  
- Point cl√© 3 en fran√ßais"
```

Exemples de messages de commit :
- `feat: Ajout suppression imports et cat√©gorisation historique`
- `fix: Correction filtrage intervalle d'import des donn√©es CSV`
- `refactor: Centralisation gestion configuration Gmail`
- `style: Am√©lioration design responsive mobile`

### Structure des messages de commit
- Utiliser les pr√©fixes conventionnels : `feat:`, `fix:`, `refactor:`, `style:`, `docs:`
- Description courte en fran√ßais (premi√®re ligne)
- D√©tails en fran√ßais avec tirets (lignes suivantes)
- Mentionner les breaking changes si applicable

### D√©ploiement manuel
**Local :** Apr√®s le commit, l'utilisateur ex√©cutera manuellement :
```bash
./deploy-local.sh "Message du commit"
```

**Production :** Commit + d√©ploiement en une seule commande :
```bash
./deploy-production.sh "Message du commit"
```

### ‚ö†Ô∏è R√©solution des erreurs de d√©ploiement

**Si `./deploy-production.sh` lance le serveur de d√©veloppement :**
1. V√©rifier que le script n'a pas √©t√© modifi√©
2. S'assurer d'utiliser la syntaxe avec guillemets : `./deploy-production.sh "message"`
3. Contr√¥ler les permissions du script : `chmod +x deploy-production.sh`

**Messages d'erreur courants :**
- `‚ùå Serveur backend non accessible` ‚Üí Script en cours d'ex√©cution, attendre la fin
- `Permission denied` ‚Üí Ex√©cuter `chmod +x deploy-production.sh`
- `No such file` ‚Üí V√©rifier d'√™tre dans le r√©pertoire racine du projet

### Tests avant d√©ploiement
- V√©rifier le build frontend (`npm run build`)
- Tester les nouvelles fonctionnalit√©s localement
- V√©rifier les logs backend pour les erreurs
- Valider l'interface sur diff√©rentes tailles d'√©cran

## Maintenance et debugging
- Utiliser `pm2 logs pelletsfun-backend` pour les logs
- Surveiller l'utilisation MongoDB Atlas (quota 512MB)
- V√©rifier les certificats SSL et la configuration Nginx
- Maintenir la documentation des nouvelles fonctionnalit√©s